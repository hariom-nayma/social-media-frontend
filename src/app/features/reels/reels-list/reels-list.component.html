<div class="reel-container" *ngIf="!loading && !error" aria-live="polite">
  <div *ngFor="let reel of reels; let i = index" class="reel">
    <!-- Top progress (small thin indicator like Reels) -->
    <div class="top-progress">
      <div class="progress-bar"></div>
    </div>

    <div class="video-wrapper" (click)="togglePlayPause(i)">
      <video
        #videoEl
        class="reel-video"
        [src]="reel.mediaVideoUrl"
        loop
        muted
        playsinline
        preload="metadata"
        (dblclick)="$event.stopPropagation(); onVideoDoubleTap(i)"
        title="Reel video"
      ></video>

      <!-- center heart pop -->
      <div class="heart-pop" *ngIf="heartVisible[i]">‚ù§</div>
    </div>

    <!-- Overlay gradient -->
    <div class="overlay"></div>

    <!-- Left bottom info -->
    <div class="reel-info">
      <div class="user">
        <img
          alt="profileImage"
          [src]="reel.reelUser?.profileImage || profilePlaceholder()"
        />
        <div class="meta">
          <div class="username">@{{ reel.reelUser?.username }}</div>
          <div class="music">üéµ {{ reel.caption || 'Original audio' }}</div>
        </div>
      </div>
      <p class="caption" *ngIf="reel.caption">{{ reel.caption }}</p>
    </div>

    <!-- Right action buttons -->
    <div class="actions" role="group" aria-label="reel actions">
      <button class="icon-btn like-btn" title="Like" (click)="likeReel(reel, i)">
        <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
             [attr.fill]="reel.likedByMe ? 'currentColor' : 'none'" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
        <span class="count">{{ reel.likeCount || 0 }}</span>
      </button>

      <button class="icon-btn" title="Comments" (click)="commentReel(reel)">
        <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        <span class="count">{{ reel.commentCount || 0 }}</span>
      </button>

      <button class="icon-btn" title="Reshare" (click)="reshareReel(reel)">
        <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.516 3.832a3 3 0 00.617-2.485l-1.27-2.785m-1.27 2.785A3 3 0 1115 9c0 .482-.114.938-.316 1.342"/>
        </svg>
        <span class="count">{{ reel.reshareCount || 0 }}</span>
      </button>

      <button class="icon-btn" title="Share" (click)="shareReel(reel)">
        <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7M12 3v13M7 8l5-5 5 5"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<div *ngIf="loading" class="loading-screen">Loading Reels...</div>
<div *ngIf="error" class="error-screen">{{ error }}</div>
