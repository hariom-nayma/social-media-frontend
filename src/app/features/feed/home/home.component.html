<div class="home-container app-shell">
  <!-- Left Feed Section -->
  <main class="feed-section">
    <app-story-bar></app-story-bar>

    <div class="feed" role="list">
      <app-post-card
        role="listitem"
        *ngFor="let post of posts"
        [post]="post"
        (postDeleted)="onPostDeleted($event)"
        (click)="openPostDetailsDialog(post.id)"
        class="post-card-entry"
      ></app-post-card>

      <div *ngIf="posts.length === 0" class="empty-state">
        No posts yet â€” follow creators to fill your feed.
      </div>
    </div>
  </main>

  <!-- Post Details Modal -->
  <app-post-details-dialog
    *ngIf="showPostDetailsDialog"
    [postId]="selectedPostId!"
    (close)="closePostDetailsDialog()"
  ></app-post-details-dialog>

  <!-- Right Sidebar -->
  <aside class="right-sidebar" aria-labelledby="suggestions-heading">
    <div class="profile-section">
      <img alt="profile" [src]="currentUser?.profileImageUrl || 'https://i.pravatar.cc/150?u=' + currentUser?.username"
           [alt]="currentUser?.username + ' avatar'" class="profile-pic" />
      <div class="profile-info">
        <div class="username">{{ currentUser?.username }}</div>
        <div class="fullname">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</div>
      </div>
      <button class="switch-btn" aria-label="Switch account">Switch</button>
    </div>

    <section class="suggestions" aria-labelledby="suggestions-heading">
      <div class="suggestions-header">
        <div id="suggestions-heading">Suggestions for you</div>
        <a class="see-all" href="#">See All</a>
      </div>

      <div *ngFor="let suggestion of suggestions" class="suggestion" [attr.aria-label]="suggestion.username + ' suggestion'">
        <button class="suggestion-left" (click)="goToProfile(suggestion.username)" aria-label="Open profile of {{suggestion.username}}">
          <img alt="profile" [src]="suggestion.profileUrl || ('https://i.pravatar.cc/150?u=' + suggestion.username)"
               [alt]="suggestion.username + ' avatar'" class="suggestion-img" />
          <div class="suggestion-info">
            <div class="username">
              {{ suggestion.username }}
              <svg *ngIf="suggestion.premiumUser" class="premium-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="14" height="14" aria-hidden="true">
                <polygon fill="#42a5f5" points="..."/>
                <polygon fill="#fff" points="..."/>
              </svg>
            </div>
            <div class="mutual" *ngIf="suggestion.mutualCount > 0">
              {{ suggestion.mutualCount }} mutuals
            </div>
          </div>
        </button>

        <button
          class="follow-btn"
          [class.requested]="suggestion.isRequested"
          [disabled]="suggestion.isRequested && suggestion.private"
          (click)="toggleFollow(suggestion)">
          {{ suggestion.private ? (suggestion.isRequested ? 'Requested' : 'Request') : (suggestion.isFollowing ? 'Following' : 'Follow') }}
        </button>
      </div>
    </section>

    <app-pending-requests
      *ngIf="currentUser?.private && pendingRequests.length > 0"
      [pendingRequests]="pendingRequests">
    </app-pending-requests>
  </aside>
</div>
