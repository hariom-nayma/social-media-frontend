<div class="profile-container" *ngIf="userProfile">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <img
        [src]="userProfile.profileImageUrl || 'https://i.pravatar.cc/150?u=' + userProfile.id"
        alt="Profile Picture"
      />
    </div>

    <div class="profile-info">
      <div class="profile-info-header">
                <div class="profile-username">
                  @{{ userProfile.username }}
                  <svg *ngIf="userProfile.premiumUser" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="20px" height="20px"><polygon fill="#42a5f5" points="29.62,3 33.053,8.308 39.367,8.624 39.686,14.937 44.997,18.367 42.116,23.995 45,29.62 39.692,33.053 39.376,39.367 33.063,39.686 29.633,44.997 24.005,42.116 18.38,45 14.947,39.692 8.633,39.376 8.314,33.063 3.003,29.633 5.884,24.005 3,18.38 8.308,14.947 8.624,8.633 14.937,8.314 18.367,3.003 23.995,5.884"/><polygon fill="#fff" points="21.396,31.255 14.899,24.76 17.021,22.639 21.428,27.046 30.996,17.772 33.084,19.926"/></svg>
                </div>

      
      </div>

      <div class="profile-stats">
        <div>
          <strong>{{ userProfile.postsCount || 0 }}</strong> posts
        </div>
        <div (click)="openFollowersDialog()">
          <strong>{{ userProfile.followersCount || 0 }}</strong> followers
        </div>
        <div (click)="openFollowingDialog()">
          <strong>{{ userProfile.followingCount || 0 }}</strong> following
        </div>
      </div>

      <div class="profile-name">
        {{ userProfile.firstName }} {{ userProfile.lastName }}
      </div>
      <div class="profile-bio">{{ userProfile.bio }}</div>
    </div>
    <div class="actions">
      
      <button *ngIf="isOwnProfile" class="btn edit" (click)="openUpdateProfileDialog()">Edit Profile</button>
      
          <ng-container *ngIf="!isOwnProfile">
            <button class="btn primary" (click)="toggleFollow()">
              {{ userProfile.isFollowing ? 'Following' : userProfile.isPrivate && !userProfile.requested ? 'Follow' : userProfile.isPrivate && userProfile.requested? 'Requested' : 'Follow' }}
            </button>

            <button *ngIf="!userProfile.isPrivate || userProfile.isFollowing" class="btn secondary" (click)="openChat()">Message</button>
          </ng-container>

          <button class="icon-btn" (click)="toggleMoreOptions()">
            â‹®
          </button>

          <!-- Options Dropdown -->
          <div class="dropdown" *ngIf="showMoreOptions">
            <div class="dropdown-item" (click)="copyProfileUrl()">Copy profile link</div>
            <div class="dropdown-item danger" *ngIf="!isOwnProfile" (click)="toggleBlockUser()">
              {{ userProfile.isBlockedByMe ? 'Unblock user' : 'Block user' }}
            </div>
            <div class="dropdown-item" (click)="toggleMoreOptions()">Cancel</div>
          </div>
        </div>
      </div>

  

  <!-- Tabs for Posts, Saved Posts, and Reels -->
  <div class="profile-tabs">
    <button
      class="tab-button"
      [class.active]="activeTab === 'posts'"
      (click)="selectTab('posts')"
    >
      Posts
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'saved'"
      (click)="selectTab('saved')"
      *ngIf="isOwnProfile"
    >
      Saved
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'reels'"
      (click)="selectTab('reels')"
    >
      Reels
    </button>
  </div>

  <!-- Profile Posts Grid -->
  <div
    class="profile-posts-grid"
    *ngIf="activeTab === 'posts' && userProfile.posts?.length"
  >
    <div
      class="post-thumbnail"
      *ngFor="let post of userProfile.posts"
      (click)="openPostDetailsDialog(post.id)"
    >
      <div class="post-img-wrapper">
        <img
          [src]="post.mediaUrl || 'https://via.placeholder.com/300'"
          alt="Post Image"
          class="post-img"
        />
      </div>
      <div class="post-overlay">
        <div class="post-overlay-item">
          <i class="fas fa-heart"></i> {{ post.likeCount }}
        </div>
        <div class="post-overlay-item">
          <i class="fas fa-comment"></i> {{ post.commentCount }}
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="activeTab === 'posts' && !userProfile.posts?.length && !userProfile.isPrivate "
    class="no-posts"
  >
    <p>No posts yet</p>
  </div>


  <div *ngIf="userProfile.isPrivate && !userProfile.isFollowing && !isOwnProfile" class="private-account no-posts" >
<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 48 48" width="144px" height="144px" baseProfile="basic"><path fill="#0060fd" d="M30,18v4c0,1.654,1.346,3,3,3h2c1.654,0,3-1.346,3-3v-4H30z" opacity=".1"/><path fill="#0060fd" d="M30.5,18v4c0,1.379,1.121,2.5,2.5,2.5h2c1.379,0,2.5-1.121,2.5-2.5v-4H30.5z" opacity=".2"/><path fill="#0060fd" d="M31,18v4c0,1.103,0.897,2,2,2h2c1.103,0,2-0.897,2-2v-4H31z" opacity=".3"/><path fill="#0060fd" d="M31.5,18v4c0,0.828,0.672,1.5,1.5,1.5h2c0.828,0,1.5-0.672,1.5-1.5v-4H31.5z" opacity=".4"/><path fill="#0060fd" d="M32,18v4c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1v-4H32z" opacity=".8"/><path fill="#0060fd" d="M10,18v4c0,1.654,1.346,3,3,3h2c1.654,0,3-1.346,3-3v-4H10z" opacity=".1"/><path fill="#0060fd" d="M10.5,18v4c0,1.379,1.121,2.5,2.5,2.5h2c1.379,0,2.5-1.121,2.5-2.5v-4H10.5z" opacity=".2"/><path fill="#0060fd" d="M11,18v4c0,1.103,0.897,2,2,2h2c1.103,0,2-0.897,2-2v-4H11z" opacity=".3"/><path fill="#0060fd" d="M11.5,18v4c0,0.828,0.672,1.5,1.5,1.5h2c0.828,0,1.5-0.672,1.5-1.5v-4H11.5z" opacity=".4"/><path fill="#0060fd" d="M12,18v4c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1v-4H12z" opacity=".8"/><linearGradient id="aBsDE_ySxJjZM2g4l05fda" x1="24" x2="24" y1="-1.109" y2="18.891" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#97f8ff"/><stop offset=".125" stop-color="#8ef3ff"/><stop offset=".328" stop-color="#76e4fe"/><stop offset=".584" stop-color="#4eccfe"/><stop offset=".88" stop-color="#18abfc"/><stop offset="1" stop-color="#009cfc"/></linearGradient><path fill="url(#aBsDE_ySxJjZM2g4l05fda)" d="M35,23h-2c-0.552,0-1-0.448-1-1l0-6.717c0-4.257-3.205-7.98-7.452-8.264	C19.89,6.706,16,10.408,16,15v7c0,0.552-0.448,1-1,1h-2c-0.552,0-1-0.448-1-1l0-6.649c0-6.245,4.626-11.712,10.844-12.297	C29.979,2.383,36,8.001,36,15v7C36,22.552,35.552,23,35,23z"/><g><rect width="4" height="4" x="12" y="16" fill="#2e8efe" opacity=".1"/><rect width="4" height="3.6" x="12" y="16.4" fill="#2e8efe" opacity=".2"/><rect width="4" height="3.2" x="12" y="16.8" fill="#2e8efe" opacity=".3"/><rect width="4" height="2.8" x="12" y="17.2" fill="#2e8efe" opacity=".4"/><rect width="4" height="2.4" x="12" y="17.6" fill="#2e8efe" opacity=".5"/></g><g><rect width="4" height="4" x="32" y="16" fill="#2e8efe" opacity=".1"/><rect width="4" height="3.6" x="32" y="16.4" fill="#2e8efe" opacity=".2"/><rect width="4" height="3.2" x="32" y="16.8" fill="#2e8efe" opacity=".3"/><rect width="4" height="2.8" x="32" y="17.2" fill="#2e8efe" opacity=".4"/><rect width="4" height="2.4" x="32" y="17.6" fill="#2e8efe" opacity=".5"/></g><g><path fill="#2e8efe" d="M12,18v4c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1v-4H12z"/><path fill="#2e8efe" d="M32,18v4c0,0.552,0.448,1,1,1h2c0.552,0,1-0.448,1-1v-4H32z"/></g><linearGradient id="aBsDE_ySxJjZM2g4l05fdb" x1="24" x2="24" y1="21.261" y2="42.521" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#daa6ff" stop-opacity=".6"/><stop offset="1" stop-color="#dca6ff" stop-opacity=".4"/></linearGradient><path fill="url(#aBsDE_ySxJjZM2g4l05fdb)" d="M38,18H10c-1.105,0-2,0.895-2,2v9	c0,9.389,6.611,16,16,16s16-6.611,16-16v-9C40,18.895,39.105,18,38,18z M25.129,31.776L26,37h-4l0.871-5.224	C21.774,31.33,21,30.257,21,29c0-1.657,1.343-3,3-3s3,1.343,3,3C27,30.257,26.226,31.33,25.129,31.776z"/><linearGradient id="aBsDE_ySxJjZM2g4l05fdc" x1="24" x2="24" y1="15.848" y2="31.803" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#eed9ff" stop-opacity=".2"/><stop offset="1" stop-color="#daa6ff" stop-opacity=".6"/></linearGradient><path fill="url(#aBsDE_ySxJjZM2g4l05fdc)" d="M38,18.5c0.827,0,1.5,0.673,1.5,1.5v9	c0,9.126-6.374,15.5-15.5,15.5S8.5,38.126,8.5,29v-9c0-0.827,0.673-1.5,1.5-1.5H38 M22.316,32.065l-0.809,4.853L21.41,37.5H22h4	h0.59l-0.097-0.582l-0.809-4.853C26.799,31.455,27.5,30.292,27.5,29c0-1.93-1.57-3.5-3.5-3.5s-3.5,1.57-3.5,3.5	C20.5,30.292,21.201,31.455,22.316,32.065 M38,18H10c-1.105,0-2,0.895-2,2v9c0,9.389,6.611,16,16,16s16-6.611,16-16v-9	C40,18.895,39.105,18,38,18L38,18z M22,37l0.871-5.224C21.774,31.33,21,30.257,21,29c0-1.657,1.343-3,3-3s3,1.343,3,3	c0,1.257-0.774,2.33-1.871,2.776L26,37H22L22,37z"/></svg>    <p>This profile is private.</p>
    <p> Follow this user to see their posts.</p>
  </div>

  <!-- Saved Posts Grid -->
  <div
    class="profile-posts-grid"
    *ngIf="activeTab === 'saved' && savedPosts.length"
  >
    <div
      class="post-thumbnail"
      *ngFor="let post of savedPosts"
      (click)="openPostDetailsDialog(post.id)"
    >
      <div class="post-img-wrapper">
        <img
          [src]="post.mediaUrl || 'https://via.placeholder.com/300'"
          alt="Post Image"
          class="post-img"
        />
      </div>
      <div class="post-overlay">
        <div class="post-overlay-item">
          <i class="fas fa-heart"></i> {{ post.likeCount }}
        </div>
        <div class="post-overlay-item">
          <i class="fas fa-comment"></i> {{ post.commentCount }}
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="activeTab === 'saved' && !savedPosts.length"
    class="no-posts"
  >
    <p>No saved posts yet</p>
  </div>

  <!-- Reels Grid -->
  <div
    class="profile-posts-grid"
    *ngIf="activeTab === 'reels' && userReels.length"
  >
    <div
      class="post-thumbnail"
      *ngFor="let reel of userReels"
      (click)="openReelDetailsDialog(reel.id)" 
    >
      <div class="post-img-wrapper">
        <video
          [src]="reel.mediaVideoUrl"
          class="post-img"
        ></video>
        <div class="play-button-overlay">
          <mat-icon class="play-icon">play_arrow</mat-icon>
        </div>
      </div>
      <div class="post-overlay">
        <div class="post-overlay-item">
          <i class="fas fa-heart"></i> {{ reel.likeCount }}
        </div>
        <div class="post-overlay-item">
          <i class="fas fa-comment"></i> {{ reel.commentCount }}
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="activeTab === 'reels' && !userReels.length"
    class="no-posts p-8 bg-gray-50 rounded-lg shadow-inner mt-8"
  >
    <p class="text-lg font-medium text-gray-600">No reels yet</p>
    <p class="text-sm text-gray-500 mt-2">Start creating and sharing your reels!</p>
  </div>

</div>
<div *ngIf="isBlockedByViewer" class="blocked-profile-message">
 <p>Unable to show this user's profile.</p>
 <p>You are blocked by this user.</p>
</div>
