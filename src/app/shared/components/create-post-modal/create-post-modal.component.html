<div class="modal is-active">
  <div class="modal-background" (click)="closeModal.emit()"></div>

  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Create Post</p>
      <button class="delete" aria-label="close" (click)="closeModal.emit()"></button>
    </header>

    <section class="modal-card-body">
      <form [formGroup]="postForm" (ngSubmit)="submit()">
        <!-- âœï¸ Caption -->
        <div class="field">
          <div class="control textarea-container"
            [class.ai-loading]="isGeneratingCaption">
            <textarea
              class="textarea"
              placeholder="What's on your mind?"
              formControlName="content"
              [readonly]="isGeneratingCaption">
            </textarea>
            <div class="shimmer" *ngIf="isGeneratingCaption"></div>
          </div>
        </div>

        <!-- ðŸ§  AI Caption -->
        <div class="field is-grouped">
          <p class="control is-expanded">
            <input
              class="input"
              type="text"
              placeholder="Prompt for AI caption"
              [(ngModel)]="aiCaptionPrompt"
              [ngModelOptions]="{ standalone: true }"
            />
          </p>
          <p class="control">
            <button
              class="button is-info"
              type="button"
              (click)="generateAutoCaption()"
              [disabled]="isGeneratingCaption"
            >
              <span *ngIf="!isGeneratingCaption">Generate Caption</span>
              <span *ngIf="isGeneratingCaption">âœ¨ Magic...</span>
            </button>
          </p>
        </div>

        <!-- ðŸ“· File Upload -->
        <div class="field file-field">
          <label class="file-label">
            <input class="file-input" type="file" name="media" (change)="onFileChange($event)" accept="image/*">
            <span class="file-cta">
              <i class="fas fa-upload"></i> Choose a fileâ€¦
            </span>
          </label>

          <div *ngIf="mediaPreview" class="preview-box">
            <img *ngIf="postForm.get('media')?.value?.type?.startsWith('image')" 
                 [src]="mediaPreview" alt="Preview" />
            <video *ngIf="postForm.get('media')?.value?.type?.startsWith('video')" 
                   [src]="mediaPreview" controls></video>
          </div>
        </div>

        <p class="help is-danger" *ngIf="postForm.touched && postForm.errors?.['contentOrMediaRequired']">
          Please provide either content or a media file.
        </p>
      </form>
    </section>

    <footer class="modal-card-foot">
      <button class="button is-success"
              [disabled]="postForm.invalid || isUploading"
              [class.loading]="isUploading"
              (click)="submit()">
        <span *ngIf="!isUploading">Post</span>
        <span *ngIf="isUploading" class="loader"></span>
      </button>
      <button class="button" (click)="closeModal.emit()">Cancel</button>
    </footer>
  </div>
</div>
