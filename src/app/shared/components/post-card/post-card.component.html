<div class="post-card">
  <!-- Header -->
  <div class="post-header">
    <div class="user-info" [routerLink]="['/profile', post.username]">
      <img [src]="post.profileImage" alt="User Avatar" class="avatar" />
      <div>
        <div class="username">{{ post.username }}</div>
        <div class="location">{{ 'Unknown location' }}</div>
      </div>
    </div>
    <button title="options" class="options-btn" (click)="showOptionsMenu = !showOptionsMenu; $event.stopPropagation()">
      <i class="fas fa-ellipsis-h"></i>
    </button>
  </div>

  <!-- Options Menu -->
  <div *ngIf="showOptionsMenu" class="options-menu-overlay" (click)="showOptionsMenu = false; $event.stopPropagation()">
    <div class="options-menu" (click)="$event.stopPropagation()">
      <ng-container *ngIf="post?.username === currentUser?.username">
        <button class="option-item destructive" (click)="deletePost()">Delete post</button>
        <button class="option-item" (click)="archivePost()" *ngIf="!post?.archived">Archive post</button>
        <button class="option-item" (click)="unarchivePost()" *ngIf="post?.archived">Unarchive post</button>
        <button class="option-item" (click)="showOptionsMenu = false">Cancel</button>
      </ng-container>
      <ng-container *ngIf="post?.username !== currentUser?.username">
        <button class="option-item" (click)="viewProfile()">View profile</button>
        <button class="option-item" (click)="toggleFollow()">
          {{ post?.following ? 'Unfollow' : 'Follow' }}
        </button>
        <button class="option-item" (click)="copyPostUrl()">Copy post URL</button>
        <button class="option-item" (click)="showOptionsMenu = false">Cancel</button>
      </ng-container>
    </div>
  </div>

  <!-- Image with like animation -->
  <div class="post-image-container" (dblclick)="onDoubleClick()">
    <img [src]="post.mediaUrl" alt="Post" class="post-image" />
    <i *ngIf="showLikeAnimation" class="fas fa-heart like-animation"></i>
  </div>

  <!-- Actions -->
  <div class="post-actions">
    <div class="left-actions">
      <button title="like" (click)="onLike($event)">
        <i class="{{ post.likedByCurrentUser ? 'fas fa-heart liked' : 'far fa-heart'}}"></i>
      </button>
      <button title="comment" (click)="onComment($event)">
        <i class="far fa-comment"></i>
      </button>
      <button title="share" (click)="onShare($event)">
        <i class="far fa-paper-plane"></i>
      </button>
    </div>
    <button title="save" class="save-btn" (click)="onSave($event)">
      <i class="{{ post.savedByMe ? 'fas fa-bookmark saved' : 'far fa-bookmark' }}"></i>
    </button>
  </div>

  <!-- Post info -->
  <div class="post-info">
    <div class="post-likes">{{ post.likeCount }} likes</div>
    <div class="post-caption">
      <strong>{{ post.username }}</strong> {{ post.content }}
    </div>
    <div class="post-comments">View all {{ post.commentCount }} comments</div>
    <div class="post-time">{{ post.createdAt | date }}</div>
  </div>
</div>
