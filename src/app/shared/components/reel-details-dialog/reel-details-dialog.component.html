<div class="dialog-overlay" (click)="closeDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <!-- LEFT: VIDEO PLAYER -->
    <div class="reel-section">
      <app-shaka-player *ngIf="reel?.mediaVideoUrl" [manifestUrl]="reel?.mediaVideoUrl!"></app-shaka-player>
    </div>

    <!-- RIGHT: REEL INFO + COMMENTS -->
    <div class="comments-section">
      <!-- Header -->
      <div class="post-header">
        <div class="user-info">
          <img
            [src]="reel?.reelUser?.profileImage || 'https://i.pravatar.cc/150?u=' + reel?.reelUser?.id"
            class="user-avatar"
            alt="user"
          />
          <div class="user-details">
            <p class="name">
              {{ reel?.reelUser?.firstName }} {{ reel?.reelUser?.lastName }}
              <mat-icon *ngIf="reel?.reelUser?.premiumUser" class="verified-icon">verified</mat-icon>
            </p>
            <p class="username">@{{ reel?.reelUser?.username }}</p>
          </div>
        </div>

        <div class="header-actions">
          <button mat-icon-button [matMenuTriggerFor]="reelMenu" aria-label="More options">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #reelMenu="matMenu">
            <button mat-menu-item *ngIf="isOwner" (click)="deleteReel()">
              <mat-icon>delete_forever</mat-icon>
              <span>Delete Reel</span>
            </button>
            <button mat-menu-item (click)="reshareReel()">
              <mat-icon>share</mat-icon>
              <span>Share Reel</span>
            </button>
          </mat-menu>
          <button class="close-btn" title="Close" (click)="closeDialog()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <p class="post-content">{{ reel?.caption }}</p>

      <!-- Action Buttons -->
      <div class="post-actions">
        <div class="action-buttons">
          <button class="icon-btn like" (click)="likeReel()">
            <mat-icon [ngClass]="{ liked: reel?.likedByMe }">favorite</mat-icon>
          </button>
          <button class="icon-btn comment">
            <mat-icon>chat_bubble_outline</mat-icon>
          </button>
          <button class="icon-btn reshare" (click)="reshareReel()">
            <mat-icon>ios_share</mat-icon>
          </button>
        </div>
        <div class="action-counts">
          <span>{{ reel?.likeCount || 0 }} likes</span>
          <span>{{ reel?.commentCount || 0 }} comments</span>
          <span>{{ reel?.reshareCount || 0 }} shares</span>
        </div>
      </div>

      <!-- Comments -->
      <div class="comments-list">
        <div *ngIf="comments.length === 0" class="no-comments">No comments yet. Be the first âœ¨</div>

        <div *ngFor="let comment of comments" class="comment-item">
          <img
            [src]="comment.userProfileImage || 'https://i.pravatar.cc/150?u=' + comment.userId"
            class="comment-avatar"
            alt="profile"
          />
          <div class="comment-body">
            <p class="comment-username">
              <strong>{{ comment.firstName }} {{ comment.lastName }}</strong>
              <mat-icon *ngIf="comment.userProfileImage" class="verified-icon-small">verified</mat-icon>
            </p>
            <p class="comment-text">{{ comment.text }}</p>
            <button
              *ngIf="comment.userId === currentUserId"
              class="delete-comment"
              (click)="deleteComment(comment.id)"
            >
              <mat-icon>delete_outline</mat-icon> Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Add Comment -->
      <div class="comment-form">
        <input
          type="text"
          placeholder="Add a comment..."
          [(ngModel)]="newCommentText"
          (keyup.enter)="addComment()"
        />
        <button (click)="addComment()" [disabled]="!newCommentText">Post</button>
      </div>
    </div>
  </div>
</div>
